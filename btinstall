#!/bin/sh
#
# This is an attempt to make an installer for Smartphone Pentest Framework
# This is ugly as shit but it works.. could be done in perl a lot better, 
# will convert it one day. maybe. =)
# -loon aug 2012
#######################################################################


## Install needed packages

echo -e "$(tput setaf 1)\nInstalling mod_perl, dbdpg, and  expect for perl\n"; echo "$(tput sgr0)"
echo -e "$(tput setaf 1)#########################################\n"; echo "$(tput sgr0)"

apt-get -y install libapache2-mod-perl2 libexpect-perl libdbd-pg-perl libdevice-serialport-perl; 

mkdir code; cd code; 

echo -e "$(tput setaf 1)\nNow cloning Smartphone Pentest Framework...\n "; echo "$(tput sgr0)"
sleep 5; 

git clone https://github.com/georgiaw/Smartphone-Pentest-Framework.git;

echo -e "$(tput setaf 1)\nCloning has completed. Continuing Setup \n"; echo "$(tput sgr0)"
wget http://dl.google.com/android/android-sdk_r21-linux.tgz;
tar -xvzf android-sdk_r21-linux.tgz;
export PATH=${PATH}:/root/Smartphone-Pentest-Framework/android-sdk-linux/tools:/root/Smartphone-Pentest-Framework/android-sdk-linux/platform-tools
apt-get install ant1.8
android update sdk --no-ui --filter android-4
echo -e "$(tput setaf 1)Creating first time 'framework' database (empty)\n"; echo "$(tput sgr0)"

service mysql start; 
mysqladmin -u root create framework -ptoor;


# add the following to /etc/apache2/sites-enabled/000-default
#
# Under main (<VirtualHost *:80>) add the handler for perl
# Under <Directory /var/www/> add ExecCGI to the Options list

echo -e "$(tput setaf 1)\nTweaking Apaches main config file to add perl Handler and ExecCGI .. \n"; echo "$(tput sgr0)"

sed -i "s/ServerAdmin .*/& \n        AddHandler cgi-script .cgi .pl/" /etc/apache2/sites-enabled/000-default;
sed -i "s/Options Indexes FollowSymLinks.*/& ExecCGI/" /etc/apache2/sites-enabled/000-default;

echo -e "$(tput setaf 1)\nRestarting Apache... \n"; echo "$(tput sgr0)" 

/etc/init.d/apache2 start

echo -e "$(tput setaf 1)\nApache has restarted...\n"; echo "$(tput sgr0)" 

echo -e "$(tput setaf 1)\nCopying over the GUI framework to webroot...\n"; echo "$(tput sgr0)"

cp -r Smartphone-Pentest-Framework/frameworkgui /var/www/;

cd /var;

chmod 777 www

cd /var/www/frameworkgui;

find . -type d -exec chmod a+rwx {} \; ; find . -type f -iname \*.pl -exec chmod a+rx {} \; ; find . -type f -exec chmod a+r {} \;

echo -e "$(tput setaf 1)\n\nInstall of Smartphone Pentest Framework is complete!\n"; echo "$(tput sgr0)"
echo -e "$(tput setaf 1)You need to edit your config files to your liking in the following locations:\n"; echo "$(tput sgr0)"
echo -e "$(tput setaf 1)/var/www/frameworkgui/config and /root/code/Smartphone-Pentest-Framework/frameworkconsole/config\n"; echo "$(tput sgr0)"
echo -e "$(tput setaf 1)"
echo -e "$(tput setaf 1)Once config is setup you can either run ./framework.pl in the frameworkconsole directory,\n"; echo "$(tput sgr0)"
echo -e "$(tput setaf 1)Or you may open your browser to http://localhost/frameworkgui/menu.pl !\n"; echo "$(tput sgr0)"
echo -e "$(tput setaf 1)"; echo "$(tput sgr0)"
echo -e "$(tput setaf 1)This concludes the install.. enjoy!"; echo "$(tput sgr0)"


