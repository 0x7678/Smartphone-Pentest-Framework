package SPF;
use Cwd;

our $SPF_DBH;

sub readconfig {
  my ($config) = @_;
  $dir = getcwd;
  $configfile = $dir . "/config";
  my %Variables;
  open(CONFIG, "<",$configfile);
  while (<CONFIG>)
  {
    chomp;
    s/#.*//;
    s/^\s+//;
    s/\s+$//;
    my ($var, $value) = split(/\s*=\s*/, $_, 2);
    $Variables{$var} = $value;
  }
  return %Variables;
}

sub dbconnect {
  # short circuit returning active database handle
  return $SPH_DBH if (ref($SPH_DBH) && $SPH_DBH->ping());

  my (%Variables) = @_;
  $sqlserver = $Variables{"MYSQLSERVER"};
  $username = $Variables{"MYSQLUSER"};
  $password = $Variables{"MYSQLPASS"};
  $port = $Variables{"MYSQLPORT"};
  $type = $Variables{"DATABASETYPE"};

  if ($type eq "postgres") {
    $SPH_DBH = DBI->connect("DBI:Pg:dbname=framework;host=$sqlserver",$username,$password) or die "Couldn't connect to database! ($DBI::errstr)";
  } elsif ($type eq "mysql") {
    $SPH_DBH = DBI->connect("dbi:mysql:database=framework;host=$sqlserver;port=$port", $username,$password) or die "Couldn't connect to database! ($DBI::errstr)";
  }
  return $SPH_DBH;
}

1;
