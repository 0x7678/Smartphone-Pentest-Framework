#!/usr/bin/perl
use DBI;
use Cwd;
$dir = getcwd;
$configfile = $dir . "/config";
 open(CONFIG, "+<$configfile");
while (<CONFIG>)
{
        chomp;
        s/#.*//;
        s/^\s+//;
        s/\s+$//;
        ($var, $value) = split(/\s*=\s*/, $_, 2);
        $Variables{$var} = ${value};
}
$Variables{"OS"} = $^O;

        $sqlserver = $Variables{"MYSQLSERVER"};
         $username = $Variables{"MYSQLUSER"};
         $password = $Variables{"MYSQLPASS"};
         $port = $Variables{"MYSQLPORT"};
   	$type = $Variables{"DATABASETYPE"};
	
                $dropquery1 = "DROP TABLE IF EXISTS agents";
                $dropquery2 = "DROP TABLE IF EXISTS data";
                $dropquery3 = "DROP TABLE IF EXISTS modems";
		$dropquery4 = "DROP TABLE IF EXISTS remote";
		$dropquery5 = "DROP TABLE IF EXISTS client";
                  if ($type eq "postgres")
                {
                        $dbh = DBI->connect("DBI:Pg:dbname=framework;host=$sqlserver","$username","$password");
                         $createquery1 = "create table agents (id SERIAL NOT NULL PRIMARY KEY, number varchar(12),path varchar(1000), controlkey varchar(7), controlnumber varchar(12), platform varchar(12))"
;
                        $createquery2 = "create table data (id SERIAL NOT NULL PRIMARY KEY, sms varchar(2000),contacts varchar(1000), picture varchar(100), root varchar(5))";
                        $createquery3 = "create table modems (id SERIAL NOT NULL PRIMARY KEY, number varchar(12), path varchar(1000), controlkey varchar(7), type varchar(3))";
                        $createquery4 = "create table remote (id SERIAL NOT NULL PRIMARY KEY, ip varchar(15), exploit varchar(200), vuln varchar(3), agent varchar(3))";
                        $createquery5 = "create table client (id SERIAL NOT NULL PRIMARY KEY, number varchar(12), exploit varchar(200), vuln varchar(3))";
        
                }
                elsif ($type eq "mysql")
                {       
                        $createquery1 = "create table agents (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, number varchar(12),path varchar(1000), controlkey varchar(7), controlnumber varchar(12), platform varchar(12))";
                        $createquery2 = "create table data (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, sms varchar(2000),contacts varchar(1000), picture varchar(100), root varchar(5))";
                        $createquery3 = "create table modems (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, number varchar(12), path varchar(1000), controlkey varchar(7), type varchar(3))";
                        $createquery4 = "create table remote (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, ip varchar(15), exploit varchar(200), vuln varchar(3), agent varchar(3))";
                        $createquery5 = "create table client (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, number varchar(12), exploit varchar(200), vuln varchar(3))";
                        $dbh = DBI->connect("dbi:mysql:database=framework;host=$sqlserver;port=$port", $username,$password);
                }

                $sql = $dbh->prepare($dropquery1);
                $sql->execute;
                $sql = $dbh->prepare($dropquery2);
                $sql->execute;
                $sql = $dbh->prepare($dropquery3);
                $sql->execute;
 		$sql = $dbh->prepare($dropquery4);
                $sql->execute; 
		$sql = $dbh->prepare($dropquery5);
                $sql->execute;
                $sql = $dbh->prepare($createquery1);
                $sql->execute;
                $sql = $dbh->prepare($createquery2);
                $sql->execute;
                $sql = $dbh->prepare($createquery3);
                $sql->execute;
 		$sql = $dbh->prepare($createquery4);
                $sql->execute;
 		$sql = $dbh->prepare($createquery5);
                $sql->execute;
#####This sends it back to the main page.

my $url = "menu.pl";
print "Location: $url\n\n";

