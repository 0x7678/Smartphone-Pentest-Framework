#!/usr/bin/perl
use Cwd;
use DBI;
use FindBin qw($Bin);
use lib "$Bin/lib";
use SPF;
my %Variables = SPF::readconfig();
my $dbh = SPF::dbconnect(%Variables);
$webserver = $Variables{"WEBSERVER"};
        $ipaddress = $Variables{"IPADDRESS"};
$path = $ARGV[0];
	$filename = $ARGV[1];
	$number = $ARGV[2];
$platform = $ARGV[3];
$modem = $ARGV[4];
chomp($platform);
if ($platform eq "android")
{
$link = "http://" . $ipaddress . $path . $filename;
			 $fullpath = $webserver. $path;
		        $command1 = "mkdir " . $fullpath;
        		system($command1);
			$location = $Variables{"ANDROIDAGENT"};
			
			$command = "cp " . $location . " " . $webserver . $path . $filename;
			system($command);
			  
                       

                          	$sql = $dbh->prepare("SELECT path from modems where id=?");
                                $results = $sql->execute($modem);
                                @rows = $sql->fetchrow_array();
                                $path2 = @rows[0];

                                $sql = $dbh->prepare("SELECT controlkey from modems where id=?");
                                $results2 = $sql->execute($modem);
                                @rows = $sql->fetchrow_array();
                                $key2 = @rows[0];

				 $control = $webserver . $path2 . "/getfunc";
                        	open(CONTROLFILE, ">",$control) or die "Couldn't open $control for writing ($!)";
				$command2 = $key2 . " " . "SEND" . " " . $number . " " . "This is a cool app: " . $link;
                        	print CONTROLFILE $command2;
                       		close(CONTROLFILE);
}
