#!/usr/bin/perl
BEGIN { use CGI::Carp qw(fatalsToBrowser); };
use DBI;
use Cwd;
use FindBin qw($Bin);
use lib "$Bin/lib";
use SPF;
use CGI ':cgi-lib';

my %FORM = Vars();
$platform = $FORM{"platformDD2"};
$path = $FORM{"hostingPath"};
$filename = $FORM{"fileName"};
$number = $FORM{"phNo2Attack"};
$modemNo = $FORM{"modemNoDD2"};


##----- put your code here
my %Variables = SPF::readconfig();
my $dbh = SPF::dbconnect(%Variables);
#print "Content-type: text/html\r\n\r\n";
$webserver = $Variables{"WEBSERVER"};

$Variables{"OS"} = $^O;
			$sql = $dbh->prepare("SELECT id FROM modems WHERE number = ?");
			$results = $sql->execute($modemNo);
			@rows = $sql->fetchrow_array();
			$modem = @rows[0];
@exec = (qw(perl directdownload.pl),$path,$filename,$number,$platform,$modem);
                        $pid = fork;
                        die "fork failed" unless defined $pid;
                        if ($pid ==0)
                        {
			
			open STDIN,'<','/dev/null';
			open STDOUT,'<','/dev/null';
			open STDERR,'>&STDOUT';
			exec {$exec[0]} @exec;
			}
#print $startcommand;
##----- end of your code

my $url = "menu.pl";
print "Location: $url\n\n";
