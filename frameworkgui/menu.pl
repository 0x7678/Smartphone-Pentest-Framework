#!/usr/bin/perl
BEGIN { use CGI::Carp qw(fatalsToBrowser); };
use DBI;
use Cwd;
use FindBin qw($Bin);
use lib "$Bin/lib";
use SPF;
my %Variables = SPF::readconfig();
my $dbh = SPF::dbconnect(%Variables);
$Variables{"OS"} = $^O;

$sqlserver = $Variables{"MYSQLSERVER"};
         $username = $Variables{"MYSQLUSER"};
         $password = $Variables{"MYSQLPASS"};
         $port = $Variables{"MYSQLPORT"};
	 $type = $Variables{"DATABASETYPE"}; 
  	if ($type eq "mysql")
        {     
		   if (! defined $dbh)
                   {
                           (@exec) = qw(mysqladmin -u ),$username,"-p",$port,"-h",$sqlserver,qw(create framework -p),$password;
                           system {$exec[0]} @exec;
                           $dbh = SPF::dbconnect(%Variables);
                   }

       	 }
         $sql = $dbh->prepare("SELECT number from agents");
         $sql2 = $dbh->prepare("SELECT number from modems");
	 

print "Content-type: text/html \n\n"; 
print <<"EOT";

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/transitional.dtd">

<html>

<head>
      <title>SmartPhone PenTest Framework V0.1</title>
      <meta name="author" content="Georgia Weidman" />

      <link rel="stylesheet" href="styles.css" />
      


      <script language="javascript" type="text/javascript">
      <!--

        function resetButtons()
        {
           document.getElementById("attach").style.display="none";
           document.getElementById("attachRadio").style.display="block";
           document.getElementById("sendCommand").style.display="none";
           document.getElementById("sendCommandRadio").style.display="block";
           document.getElementById("infoGathered").style.display="none";
           document.getElementById("infoGatheredRadio").style.display="block";
           document.getElementById("attachMobileModem").style.display="none";
           document.getElementById("attachMobileModemRadio").style.display="block";
           document.getElementById("remoteAttack").style.display="none";
           document.getElementById("remoteAttackRadio").style.display="block";
           document.getElementById("SEorCSAttack").style.display="none";
           document.getElementById("SEorCSAttackRadio").style.display="block";
           document.getElementById("database").style.display="none";
           document.getElementById("databaseRadio").style.display="block";

        }

        function resetOptions()
        {
           document.getElementById("deliveryMethod").style.display="none";
           document.getElementById("returnMethod").style.display="none";
           document.getElementById("message").style.display="none";
           document.getElementById("submitSend").style.display="none";
           document.getElementById("submitPicture").style.display="none";
           document.getElementById("submitContacts").style.display="none";
           document.getElementById("submitGetDatabase").style.display="none";
           document.getElementById("submitEscalate").style.display="none";
           document.getElementById("recipient").style.display="none";
           document.getElementById("modemNumber").style.display="none";
        }



	function showDiv(divName, radio) 
	{
           resetButtons();
	   document.getElementById(divName).style.display="block";
           document.getElementById(radio).style.display="none";
        }

	function showDiv2(divName) 
	{
	   document.getElementById(divName).style.display="block";
        }
        
	function hideDiv(divName)
	{
	   document.getElementById(divName).style.display="none";
	}

 	
	function confirmAndCreate()
	{
		var answer=confirm("This will destroy your data. Are you sure you want to do this?");
 		if (answer)
		     submitForm(1);
	}	
	function showButton(divName) 
	{
	   document.getElementById(divName).style.display="block";
        }
	function submitForm(which)
	{
		if (which == 1)
			document.forms["main"].action="createDatabase.pl";	
		else if (which == 2)
			document.forms["main"].action="SEAttack.pl";
                else if (which == 3)
			document.forms["main"].action="CSAttack.pl";
                else if (which == 4)
			document.forms["main"].action="remoteAttack.pl";
                else if (which == 5)
			document.forms["main"].action="search.pl";
                else if (which == 6)
			document.forms["main"].action="attachMobileModem.pl";
                else if (which == 7)
			document.forms["main"].action="viewInfo.pl";
                else if (which == 8)
			document.forms["main"].action="sendSMS.pl";
                else if (which == 9)
			document.forms["main"].action="takePic.pl";
                else if (which == 10)
			document.forms["main"].action="getContacts.pl";
                else if (which == 11)
			document.forms["main"].action="getDatabase.pl";                
		else if (which == 12)
			document.forms["main"].action="escalatePrivileges.pl";
                else if (which == 13)
			document.forms["main"].action="attach2Agents.pl";
		else if (which == 14)
                        document.forms["main"].action="guessPassword.pl";
	
		document.forms["main"].submit();
	}

	function modemNum()
	{
		if(document.getElementById('smsDelivery').checked || document.getElementById('smsReturn').checked)
			showDiv2("modemNumber");
		else hideDiv("modemNumber"); 
  
	} 
 


      //-->
      </script>
</head>
<body>
<form id="main" name="main" method="post">
<fieldset>
     <legend><img src="bulb.jpg" height="100" width="350"></legend>
     <br /><br />

<!-- ------------Attach -------->


<div id="attachRadio"><input type="radio"  name="options" value="Attach " onClick="showDiv('attach','attachRadio')" />  
     Attach Framework to Deployed Agent
     <br />
</div>
<div id="attach" name="attach" >
	
<fieldset>
	<legend>Attach Framework to Deployed Agent</legend> 
        <br />
	<label for="agentPhNo">Agent Phone Number: </label> <br /> <input type=text name="agentPhNo" /> 

        <br /><br />


        <label for="controlPhNo">Control Phone Number: </label>  <br /> <input type=text name="controlPhNo" /> 
        
<div id="secondColumn" name="secondColumn">
        <label for="agentURLPath">Agent URL Path: </label><br /><input type=text name="agentURLPath" /> 
        <br /><br />

	<label for="agentControlKey">Agent Control Key: </label> <br /> <input type=text name="agentControlKey" /> 
        <br />
</div>

<div id="platform1" name="platform1">
        <label for="platformDD1">Platform: </label> <br /> 
        <select id="platformDD1" name="platformDD1">
            <option value="android">Android</option>
            <option value="iphone">iPhone</option>
            <option value="blackberry">Blackberry</option>
        </select>
            
        <br />
</div>

	<br /><input type="submit" class="submitButton" name="submitAttach" id="submitAttach" value="Attach "              onclick="submitForm(13);"/>

<br />
<br />

        
</fieldset>
</div>

<br />

<!-- ------------Send Command -------------->	


<div id="sendCommandRadio">
      <input type="radio" name="options" value="SendCommand" onClick="showDiv('sendCommand', 'sendCommandRadio')" /> 
      Send Command<br />
</div>
<div id="sendCommand">
<fieldset>  
      <legend>Send Command</legend><br />
      <label for="agentDD">Choose Agent:  </label>  <br /> 
	  <select name="agentsDD" id="agentsDD">

EOT

	$sql->execute;
        while ($id=$sql->fetchrow_array())
        {

		print "<option>$id</option>";
	}

print <<"ET";
           
      </select>
      <br /> <br />

      <input type="radio"  name="options" value="sendSMS" 
          onclick="resetOptions();showDiv2('deliveryMethod');showDiv2('recipient');
               showDiv2('message');modemNum();showButton('submitSend');" />   
          Send SMS  <br />
      <input type="radio"  name="options" value="takePic" onclick="resetOptions();
                showDiv2('deliveryMethod');modemNum(); showButton('submitPicture');" />   
          Take Picture  <br />
      <input type="radio"  name="options" value="getContacts" 
          onclick="resetOptions();showDiv2('deliveryMethod');showDiv2('returnMethod');modemNum();
             showButton('submitContacts'); " />              
              Get Contacts   <br />
      <input type="radio"  name="options" value="getSMSDatabase" 
          onclick="resetOptions();showDiv2('deliveryMethod');showDiv2('returnMethod');modemNum();
              showButton('submitGetDatabase'); " />
                 Get SMS Database  <br />
      <input type="radio"  name="options" value="getSMSDatabase" 
          onclick="resetOptions();showDiv2('deliveryMethod'); modemNum();
              showButton('submitEscalate'); " />  
              Privilege Escalation
      <br /> <br />

<div id="deliveryMethod" name="deliveryMethod">
      <label for="deliveryMethodRB">Delivery Method: </label> <br />
      <input type="radio" name="deliveryMethodRB" id="smsDelivery" value="SMS" onclick="modemNum();">SMS &nbsp; &nbsp;
      <input type="radio" name="deliveryMethodRB" id="httpDelivery" value="HTTP" onclick="modemNum();">HTTP<br />
</div>

<div id="returnMethod" name="returnMethod">
     <label for="returnMethodRB">Return Method: </label> <br />
     <input type="radio" name="returnMethodRB" id="smsReturn" value="SMS" onclick="modemNum();">SMS &nbsp; &nbsp;
     <input type="radio" name="returnMethodRB" id="httpReturn" value="HTTP" onclick="modemNum();">HTTP<br />
</div>

<div id="message" name="message">
     <label for="messageTB">Message: </label> <br /> 
     <textarea rows="3" cols="20" name="messageTB" id="messageTB" ></textarea> 
     <br /> <br />
</div>

<div id="recipient" name="recipient">
	<label for="recipient">Recipient's Phone No: </label> <br /> <input type=text name="recipient" /> 
        <br />
</div>

<div id="modemNumber" name="modemNumber">
<label for="modemNoDD">Mobile Modem Number:  </label>  <br />
     <select name="modemNoDD" id="modemNoDD">

ET

	$sql2->execute;
        while ($no =$sql2->fetchrow_array())
        {

		print "<option>$no</option>";
	}

print <<"ET";

</select>
</div>
	<br />
	<input type="submit" class="submitButton" name="submitSend" id="submitSend" value="Send" 
            onclick="submitForm(8);"/>
	<input type="submit" class="submitButton" name="submitPicture" id="submitPicture" value="Take Picture" 
            onclick="submitForm(9);"/>
	<input type="submit" class="submitButton" name="submitContacts" id="submitContacts" value="Get Contacts" 
            onclick="submitForm(10);"/>
	<input type="submit" class="submitButton" name="submitDatabase" id="submitGetDatabase" value="Get Database" 
            onclick="submitForm(11);"/>
	<input type="submit" class="submitButton" name="submitEscalate" id="submitEscalate" value="Escalate" 
            onclick="submitForm(12);"/>
</fieldset>
</div> 

<br />

<!--  --------------- View Info Gathered  ------------------->

<div id="infoGatheredRadio" name="infoGatheredRadio">
     <input type="radio" name="options" value="infoGathered" onClick="showDiv('infoGathered', 'infoGatheredRadio')" /> 
         View Information Gathered <br />
</div>
<div id="infoGathered" name="infoGathered">
<fieldset>  
     <legend>View Information Gathered</legend><br />
     
     <br /> <br />
     <br />
     <input type="submit" class="submitButton" name="submitView" id="submitView" value="View " 
          onclick="submitForm(7);" />
</fieldset>
</div>


<br /> 

<!--  --------------- Attach Framework to Mobile Modem ------------------->


<div id="attachMobileModemRadio" name="attachMobileModemRadio">
     <input type="radio" name="options" value="attachMobileModem" 
         onClick="showDiv('attachMobileModem', 'attachMobileModemRadio')" /> Attach Framework to Mobile Modem <br />
</div>
<div id="attachMobileModem" name="attachMobileModem">
<fieldset>  
     <legend>Attach Framework to Mobile Modem</legend><br /> <br />

     <input type="radio"  name="attachFramework" value="search" 
	onclick="hideDiv('attachSmartPhone'); hideDiv('submitAttachModemAttach'); showButton('submitAttachModemSearch');" />   
           Search For Attached Modem <br /><br />
     <input type="radio"  name="attachFramework" value="attachToApp" 
	onclick="showDiv2('attachSmartPhone');  hideDiv('submitAttachModemSearch'); showButton('submitAttachModemAttach');"/>   
           Attach to SmartPhone Based App <br />

<br />

<div id="attachSmartPhone" name="attachSmartPhone">
        <label for="modemPhoneNo">Phone Number: </label> <br /> <input type=text name="modemPhoneNo" /> 
        <br />
	<label for="controlKey">Control Key: </label> <br /> <input type=text name="controlKey" /> 
        <br />

        <label for="appURLPath">App URL Path: </label> <br /> <input type=text name="appURLPath" /> 
        <br />

</div>

        <br /> 
        <br />
        <input type="submit" class="submitButton" name="submitAttachModemSearch" id="submitAttachModemSearch"                             value="Search " onclick="submitForm(5);" />
        <input type="submit" class="submitButton" name="submitAttachModemAttach" id="submitAttachModemAttach"                             value="Attach " onclick="submitForm(6);"/>
</fieldset>

</div>

<br />


<!-- ---------- Remote Attack ------------>

<div id="remoteAttackRadio" name="remoteAttackRadio">
     <input type="radio" name="options" value="remoteAttack" 
         onClick="showDiv('remoteAttack', 'remoteAttackRadio');" /> Run a Remote Attack<br />
</div>
<div id="remoteAttack" name="remoteAttack">
<fieldset>  
     <legend>Run a Remote Attack</legend><br /> <br />

     <input type="radio"  name="defaultSSHPassword" value="password" 
            onclick="showDiv2('ipAddress');showButton('submitRemoteAttack'); hideDiv('submitGuessPassword'); hideDiv('password');" />   
           Test for Default SSH password (iPhone)<br /><br />
     

<input type="radio"  name="defaultSSHPassword" value="guessPassword" 
            onclick="showDiv2('ipAddress'); showDiv2('password');  hideDiv('submitRemoteAttack'); showButton('submitGuessPassword');" />   
           Guess SSH password (iPhone)<br /><br />
     
<br />
<div id="ipAddress" name="ipAddress">
        <label for="ipAddressTB">IP Address: </label> <br /> <input type=text name="ipAddressTB" /> 
        <br />
</div>

<div id="password" name="password">
        <label for="passwordFileTB">Password File: </label> <br /> <input type=text name="passwordFileTB" /> 
        <br />
</div>


        <input type="submit" class="submitButton" name="submitRemoteAttack"                 
                 id="submitRemoteAttack" value="Attack " onclick="submitForm(4);"/>
        <input type="submit" class="submitButton" name="submitGuessPassword"                 
                 id="submitGuessPassword" value="Attack " onclick="submitForm(14);"/>
</fieldset>
</div>


<br />



<!--  ----------------------Social Engineering or Client Side Attack ----------->

<div id="SEorCSAttackRadio">
     <input type="radio" name="options" value="SEorCSAttack" 
         onClick="showDiv('SEorCSAttack', 'SEorCSAttackRadio')" /> Run a Social Engineering or Client Side                   Attack<br />
</div>
<div id="SEorCSAttack">
<fieldset>  
     <legend>Run a Social Engineering or Client Side Attack</legend><br /> <br />

     <input type="radio"  name="SEorCSAttackRB" value="downloadAgent" 
           onclick="hideDiv('shell'); hideDiv('submitCSAttack'); showDiv2('platform2'); showDiv2('hPath'); 
                       showDiv2('otherInfo'); showDiv2('modemNumber2');showButton('submitSEAttack');" />   
           Direct Download Agent<br /> <br /> 
     <input type="radio"  name="SEorCSAttackRB" value="clientSideShell" 
           onclick="hideDiv('platform2'); hideDiv('submitSEAttack'); showDiv2('shell'); showDiv2('hPath'); showDiv2('otherInfo'); showDiv2('modemNumber2');   showButton('submitCSAttack');"  />   
           Client Side Shell<br /><br />

     
<br />

<div id="platform2" name="platform2">
        <label for="platformDD2">Platform: </label> <br /> 
        <select name="platformDD2" id="platformDD2">
            <option value="android">Android</option>
            <option value="iphone">iPhone</option>
            <option value="blackberry">Blackberry</option>
        </select>
            
        <br />
</div>

<div id="shell" name="shell">
        <label for="shellDD">Exploit: </label> <br /> 
        <select id="exploit" name="exploit">
            <option value="20101759">CVE-2010-1759 WebKit Vuln Android</option>
        </select>

        <br />
</div>

<div id="hPath" name="hPath">
        <label for="hostingPath">Hosting Path: </label> <br /> <input type=text name="hostingPath" /> 
         
        <br /><br />
</div>


<div id="otherInfo" name="otherInfo">
        <label for="fileName">File Name: </label> <br /> <input type=text name="fileName" /> <br /><br />
        <label for="phNo2Attack">Phone No to Attack: </label> <br /> <input type=text name="phNo2Attack" /> 
        <br /> &nbsp; <br /> 
</div>

<div id="modemNumber2" name="modemNumber2">
<label for="modemNoDD2">Mobile Modem Number:  </label>  <br />
     <select name="modemNoDD2" id="modemNoDD2">

EOT
ET

	$sql2->execute;
        while ($no1 =$sql2->fetchrow_array())
        {

		print "<option>$no1</option>";
	}

print <<"ET";

</select>
</div>


        <input type="submit" class="submitButton" name="submitSEAttack" id="submitSEAttack" 
             value="Attack " onclick="submitForm(2);" />
        <input type="submit" class="submitButton" name="submitCSAttack" id="submitCSAttack" 
             value="Attack " onclick="submitForm(3);" />
<br /><br /><br />
</fieldset>
</div>

<br />

<!--  ---------------------- Clear/Create Database ----------->



<div id="databaseRadio" name="databaseRadio">
     <input type="radio" name="options" value="Database" onClick="showDiv('database', 'databaseRadio');"  > 
            Clear/Create Database<br />
</div>
<div id="database">

<fieldset>  
     <legend>Clear/Create Database</legend><br /> <br />

    
<br />


    <input type="button" class="submitButton" name="submitDatabase"  id="submitDatabase" value="Clear/Create "  
            onclick="confirmAndCreate();" />
 


</fieldset>

</div>


<br />
<!--  -->





</fieldset>
</form>
</body>
</html>

ET
